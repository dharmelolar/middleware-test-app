"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.performHealthCheck = void 0;
const axios_1 = __importDefault(require("axios"));
const utils_1 = require("./utils");
const HEALTHCHECK_FAILED_MESSAGE = `MW Agent Healthcheck is failing ... This could be due to incorrect value of MW_AGENT_SERVICE
Ignore the warning if you are using MW Agent older than 1.7.7 (You can confirm by running mw-agent version`;
const performHealthCheck = (host) => {
    let endpoint = `${host}:13133/health`;
    if (!endpoint.startsWith("http")) {
        endpoint = "http://" + endpoint;
    }
    return axios_1.default
        .get(endpoint)
        .then((response) => {
        if (response.status === 200) {
            (0, utils_1.structuredLog)("INFO", "Health check to MW Agent passed", {
                status: response.status,
            });
        }
        else {
            (0, utils_1.structuredLog)("WARN", HEALTHCHECK_FAILED_MESSAGE, {
                status: response.status,
            });
        }
    })
        .catch((error) => {
        (0, utils_1.structuredLog)("WARN", HEALTHCHECK_FAILED_MESSAGE);
    });
};
exports.performHealthCheck = performHealthCheck;
